---
/**
 * Spotify Badge Component - Hero Section
 * Badge responsivo com ícone do Spotify em destaque
 *
 * Features:
 * - Desktop: Ícone grande + texto "PLAYLIST"
 * - Mobile: Badge reduzida, auto-hide após 3s
 * - Touch area mínima: 44x44px
 * - Design moderno e clean
 * - Mudança dinâmica de cor baseada na seção visível
 *
 * Color System:
 * - Hero: Verde Spotify (#1DB954) - padrão
 * - Lineup: Laranja Intenso (#ff9d28)
 * - Setores: Vermelho-Alaranjado (#ff4d2d)
 * - Sobre: Azul Teal (#007b9a)
 * - STL Valley: Verde Profundo (#006a47)
 * - FAQ: Azul Índigo (#1e1876)
 *
 * O sistema usa Intersection Observer para detectar qual seção está visível
 * e atualiza o atributo data-section da badge, aplicando os estilos CSS correspondentes.
 */

interface Props {
  playlistUrl: string;
  class?: string;
}

const { playlistUrl, class: className = '' } = Astro.props;
---

<a
  href={playlistUrl}
  target="_blank"
  rel="noopener noreferrer"
  class:list={['spotify-badge', className]}
  aria-label="Ouça a playlist oficial STL Festival no Spotify"
  data-spotify-badge
  data-section="hero"
>
  <div class="badge-content">
    <!-- Texto PLAYLIST -->
    <span class="badge-text">PLAYLIST</span>

    <!-- Ícone do Spotify em Destaque -->
    <svg
      class="spotify-icon"
      viewBox="0 0 24 24"
      fill="currentColor"
      aria-hidden="true"
    >
      <path
        d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"
      ></path>
    </svg>
  </div>
</a>

<!-- Script de Auto-hide Mobile e Color Change -->
<script>
  // Importa o script de badge detection com auto-hide
  import '@/scripts/hero/badgeDetection';

  // ========================================
  // DYNAMIC COLOR CHANGE - Baseado em seções
  // ========================================

  // Seções válidas com cores definidas no CSS
  const validSections = [
    'hero',
    'lineup',
    'setores',
    'sobre',
    'stl-valley',
    'faq',
  ];

  function updateBadgeColor(sectionId: string) {
    const badge = document.querySelector('[data-spotify-badge]') as HTMLElement;
    if (!badge) return;

    // Normalizar o ID da seção
    let normalizedSection = sectionId.toLowerCase();

    // Se não for uma seção válida, usar 'hero' como padrão
    if (!validSections.includes(normalizedSection)) {
      normalizedSection = 'hero';
    }

    // Atualizar o atributo data-section para aplicar o CSS correspondente
    badge.setAttribute('data-section', normalizedSection);
  }

  // Intersection Observer para detectar seção visível
  function setupSectionObserver() {
    const sections = document.querySelectorAll(
      'section[id], div[id^="stl-valley"]'
    );

    // Verificar suporte ao Intersection Observer
    if (!('IntersectionObserver' in window)) {
      console.warn(
        'Intersection Observer não suportado. Badge manterá cor padrão.'
      );
      return;
    }

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && entry.intersectionRatio > 0.3) {
            const sectionId = entry.target.id || 'hero';
            updateBadgeColor(sectionId);
          }
        });
      },
      {
        threshold: [0.3, 0.5, 0.7],
        rootMargin: '-100px 0px -100px 0px',
      }
    );

    sections.forEach((section) => observer.observe(section));
  }

  // Inicializar quando DOM estiver pronto
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupSectionObserver);
  } else {
    setupSectionObserver();
  }
</script>

<style>
  .spotify-badge {
    /* Position - Desktop */
    position: fixed;
    bottom: 28%; /* Acima do ticker */
    left: 0;
    z-index: 50;

    /* Visual - Design moderno */
    background: linear-gradient(
      135deg,
      var(--color-spotify) 0%,
      var(--color-spotify-light) 100%
    );
    color: white;
    border-radius: 0 16px 16px 0; /* Mais arredondado */
    padding: 0;

    /* Shadow - Elegante e pronunciada */
    box-shadow:
      0 8px 24px rgba(29, 185, 84, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);

    /* Transitions - Incluindo mudança de cor */
    opacity: 1;
    transform: scale(1);
    transform-origin: center left;
    transition:
      opacity 0.3s ease,
      transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
      background 0.6s ease,
      box-shadow 0.6s ease,
      filter 0.2s ease;

    /* Typography */
    text-decoration: none;

    /* Cursor */
    cursor: pointer;

    /* Backdrop blur sutil */
    backdrop-filter: blur(4px);
  }

  .badge-content {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.875rem 1.25rem;
  }

  /* Hover State - Desktop */
  .spotify-badge:hover {
    transform: scale(1.05) translateX(4px);
    filter: brightness(1.1);
  }

  .spotify-badge[data-section='hero']:hover {
    box-shadow:
      0 12px 32px rgba(29, 185, 84, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .spotify-badge[data-section='lineup']:hover {
    box-shadow:
      0 12px 32px rgba(255, 157, 40, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .spotify-badge[data-section='setores']:hover {
    box-shadow:
      0 12px 32px rgba(255, 77, 45, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .spotify-badge[data-section='sobre']:hover {
    box-shadow:
      0 12px 32px rgba(0, 123, 154, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .spotify-badge[data-section='stl-valley']:hover {
    box-shadow:
      0 12px 32px rgba(0, 106, 71, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  .spotify-badge[data-section='faq']:hover {
    box-shadow:
      0 12px 32px rgba(30, 24, 118, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  /* Focus State - Acessibilidade */
  .spotify-badge:focus-visible {
    outline: 3px solid white;
    outline-offset: 3px;
  }

  /* Active State */
  .spotify-badge:active {
    transform: scale(0.98) translateX(2px);
  }

  /* Icon Styling - Grande e em destaque */
  .spotify-icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .spotify-badge:hover .spotify-icon {
    transform: rotate(-8deg) scale(1.1);
  }

  /* Texto PLAYLIST */
  .badge-text {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    line-height: 1;
    opacity: 0.95;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  /* ========================================
     COLOR VARIATIONS - Seções STL
     ======================================== */

  /* Hero - Spotify Green (padrão) */
  .spotify-badge[data-section='hero'] {
    background: linear-gradient(
      135deg,
      var(--color-spotify) 0%,
      var(--color-spotify-light) 100%
    );
    box-shadow:
      0 8px 24px rgba(29, 185, 84, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* Lineup - Laranja Intenso */
  .spotify-badge[data-section='lineup'] {
    background: linear-gradient(
      135deg,
      var(--color-orange) 0%,
      var(--color-orange-light) 100%
    );
    box-shadow:
      0 8px 24px rgba(255, 157, 40, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* Setores - Vermelho-Alaranjado */
  .spotify-badge[data-section='setores'] {
    background: linear-gradient(
      135deg,
      var(--color-red) 0%,
      var(--color-red-light) 100%
    );
    box-shadow:
      0 8px 24px rgba(255, 77, 45, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* Sobre - Azul Teal */
  .spotify-badge[data-section='sobre'] {
    background: linear-gradient(
      135deg,
      var(--color-blue) 0%,
      var(--color-blue-light) 100%
    );
    box-shadow:
      0 8px 24px rgba(0, 123, 154, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* STL Valley - Verde Profundo */
  .spotify-badge[data-section='stl-valley'] {
    background: linear-gradient(
      135deg,
      var(--color-green) 0%,
      var(--color-green-light) 100%
    );
    box-shadow:
      0 8px 24px rgba(0, 106, 71, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* FAQ - Azul Índigo */
  .spotify-badge[data-section='faq'] {
    background: linear-gradient(
      135deg,
      var(--color-indigo) 0%,
      var(--color-indigo-light) 100%
    );
    box-shadow:
      0 8px 24px rgba(30, 24, 118, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* ========================================
     MOBILE RESPONSIVO (<1024px)
     ======================================== */
  @media (max-width: 1023px) {
    .spotify-badge {
      /* Position Mobile */
      position: fixed;
      bottom: 18%; /* Acima do ticker */
      left: 0;

      /* Badge compacta - apenas ícone */
      border-radius: 0 14px 14px 0;

      /* Opacidade Reduzida - Estado Ativo */
      opacity: 0.9;

      /* Z-index alto */
      z-index: 50;

      /* Shadow mais sutil em mobile */
      box-shadow:
        0 4px 16px rgba(29, 185, 84, 0.35),
        0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .badge-content {
      /* Badge quadrada apenas com ícone */
      width: 44px;
      height: 44px;
      padding: 0.5rem;
      justify-content: center;
      align-items: center;
    }

    /* Esconde o texto em mobile */
    .badge-text {
      display: none;
    }

    /* Ícone centralizado em mobile */
    .spotify-icon {
      width: 26px;
      height: 26px;
    }

    /* Estado Hidden - Após 3s de inatividade */
    .spotify-badge.is-hidden {
      opacity: 0.5;
      transition: opacity 0.5s ease;
    }

    /* Hover Mobile - Efeito mais sutil */
    .spotify-badge:hover {
      transform: scale(1.05);
      filter: brightness(1.15);
    }

    .spotify-badge:hover .spotify-icon {
      transform: rotate(0) scale(1.05);
    }

    /* Shadows específicos de hover por seção em mobile */
    .spotify-badge[data-section='hero']:hover {
      box-shadow:
        0 6px 20px rgba(29, 185, 84, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }

    .spotify-badge[data-section='lineup']:hover {
      box-shadow:
        0 6px 20px rgba(255, 157, 40, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }

    .spotify-badge[data-section='setores']:hover {
      box-shadow:
        0 6px 20px rgba(255, 77, 45, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }

    .spotify-badge[data-section='sobre']:hover {
      box-shadow:
        0 6px 20px rgba(0, 123, 154, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }

    .spotify-badge[data-section='stl-valley']:hover {
      box-shadow:
        0 6px 20px rgba(0, 106, 71, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }

    .spotify-badge[data-section='faq']:hover {
      box-shadow:
        0 6px 20px rgba(30, 24, 118, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }
  }

  /* ========================================
     MICRO MOBILE (<375px)
     ======================================== */
  @media (max-width: 374px) {
    .badge-content {
      width: 40px;
      height: 40px;
      padding: 0.4rem;
    }

    .spotify-icon {
      width: 24px;
      height: 24px;
    }
  }

  /* ========================================
     TABLET (768px - 1023px)
     ======================================== */
  @media (min-width: 768px) and (max-width: 1023px) {
    .spotify-badge {
      bottom: 16%; /* Acima do ticker */
      border-radius: 0 14px 14px 0;
    }

    .badge-content {
      width: 52px;
      height: 52px;
      padding: 0.625rem;
    }

    .badge-text {
      display: none;
    }

    .spotify-icon {
      width: 28px;
      height: 28px;
    }
  }

  /* ========================================
     DESKTOP LARGE (≥1440px)
     ======================================== */
  @media (min-width: 1440px) {
    .badge-content {
      padding: 1rem 1.5rem;
      gap: 0.875rem;
    }

    .spotify-icon {
      width: 36px;
      height: 36px;
    }

    .badge-text {
      font-size: 0.875rem;
      letter-spacing: 0.08em;
    }
  }

  /* ========================================
     REDUCED MOTION - Acessibilidade
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .spotify-badge,
    .spotify-icon {
      transition:
        opacity 0.3s ease,
        background 0.6s ease,
        filter 0.2s ease;
    }

    .spotify-badge:hover,
    .spotify-badge:hover .spotify-icon {
      transform: none;
      filter: brightness(1.1);
    }

    .spotify-badge,
    .spotify-icon {
      animation: none !important;
    }
  }

  /* ========================================
     ANIMATION - Indicador de interatividade
     ======================================== */
  @keyframes icon-bounce {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.08);
    }
  }

  @keyframes badge-pulse {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.02);
    }
  }

  /* Animação sutil apenas em mobile ao carregar */
  @media (max-width: 1023px) {
    .spotify-badge {
      animation: badge-pulse 1.5s ease-in-out 2;
    }

    .spotify-icon {
      animation: icon-bounce 1.5s ease-in-out 2;
    }
  }
</style>
