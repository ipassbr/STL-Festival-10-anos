---
/**
 * Accessibility Badge Component - Hero Section
 * Badge responsivo com auto-hide em mobile para economia de espaço
 *
 * Features:
 * - Desktop: Tamanho 44x44px, sempre visível
 * - Mobile: Reduzido, auto-hide após 3s (mesmo comportamento do Spotify)
 * - Touch area mínima: 44x44px (WCAG)
 * - Link interno: Scroll suave para seção #accessibility
 * - Ícone universal: ♿ (símbolo internacional de acessibilidade)
 */

import { getLangFromUrl, useTranslations } from '@/i18n/utils';

interface Props {
  targetSection?: string;
  class?: string;
}

const { targetSection = '#accessibility', class: className = '' } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<a
  href={targetSection}
  class:list={['accessibility-badge', className]}
  aria-label={t('accessibility.badgeAriaLabel')}
  data-accessibility-badge
>
  <div class="badge-content">
    <!-- Texto ACESSIBILIDADE -->
    <span class="badge-text">ACESSIBILIDADE</span>

    <!-- Ícone Universal de Acessibilidade ♿ -->
    <span class="accessibility-icon" aria-hidden="true">♿</span>
  </div>
</a>

<!-- Script de Auto-hide Mobile + Smooth Scroll -->
<script>
  // Importa o script de badge detection com auto-hide
  import '@/scripts/hero/badgeDetection';

  // Smooth scroll ao clicar
  function setupSmoothScroll() {
    const badge = document.querySelector<HTMLAnchorElement>(
      '[data-accessibility-badge]'
    );

    if (!badge) return;

    badge.addEventListener('click', (e) => {
      e.preventDefault();

      const targetId = badge.getAttribute('href');
      if (!targetId) return;

      const targetElement = document.querySelector(targetId);
      if (!targetElement) {
        console.warn(
          `Accessibility badge: target section "${targetId}" not found`
        );
        return;
      }

      // Smooth scroll
      targetElement.scrollIntoView({
        behavior: 'smooth',
        block: 'start',
      });

      // Focus no elemento alvo (acessibilidade)
      if (targetElement instanceof HTMLElement) {
        targetElement.setAttribute('tabindex', '-1');
        targetElement.focus();
      }
    });
  }

  // Aguarda DOM estar pronto
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupSmoothScroll);
  } else {
    setupSmoothScroll();
  }
</script>

<style>
  .accessibility-badge {
    /* Position - Desktop */
    position: fixed;
    bottom: 28%; /* Mesma altura do Spotify */
    right: 0; /* Encosta no lado direito */
    z-index: 50;

    /* Visual - Design moderno com gradient */
    background: linear-gradient(135deg, #007b9a 0%, #009bb8 100%);
    color: white;
    border-radius: 16px 0 0 16px; /* Mais arredondado, igual ao Spotify */
    padding: 0;

    /* Shadow - Elegante e pronunciada, igual ao Spotify */
    box-shadow:
      0 8px 24px rgba(0, 123, 154, 0.4),
      0 4px 8px rgba(0, 0, 0, 0.2);

    /* Transitions - Mesmas do Spotify */
    opacity: 1;
    transform: scale(1);
    transform-origin: center right;
    transition:
      opacity 0.3s ease,
      transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
      background 0.6s ease,
      box-shadow 0.6s ease,
      filter 0.2s ease;

    /* Typography */
    text-decoration: none;

    /* Cursor */
    cursor: pointer;

    /* Backdrop blur sutil, igual ao Spotify */
    backdrop-filter: blur(4px);
  }

  .badge-content {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.875rem 1.25rem;
  }

  /* Hover State - Desktop - Igual ao Spotify */
  .accessibility-badge:hover {
    transform: scale(1.05) translateX(-4px); /* Movimenta para esquerda (espelhado) */
    filter: brightness(1.1);
    box-shadow:
      0 12px 32px rgba(0, 123, 154, 0.5),
      0 6px 12px rgba(0, 0, 0, 0.3);
  }

  /* Focus State - Acessibilidade */
  .accessibility-badge:focus-visible {
    outline: 3px solid white;
    outline-offset: 3px;
  }

  /* Active State - Igual ao Spotify */
  .accessibility-badge:active {
    transform: scale(0.98) translateX(-2px);
  }

  /* Icon Styling - Grande e em destaque, igual ao Spotify */
  .accessibility-icon {
    flex-shrink: 0;
    font-size: 32px; /* Mesmo tamanho do ícone do Spotify */
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .accessibility-badge:hover .accessibility-icon {
    transform: rotate(8deg) scale(1.1); /* Rotação espelhada */
  }

  /* Texto ACESSIBILIDADE - Mesmo estilo do PLAYLIST */
  .badge-text {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    line-height: 1;
    opacity: 0.95;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  /* ========================================
     MOBILE RESPONSIVO (<1024px)
     ======================================== */
  @media (max-width: 1023px) {
    .accessibility-badge {
      /* Position Mobile */
      position: fixed;
      bottom: 18%; /* Mesma altura do Spotify em mobile */
      right: 0;

      /* Badge compacta - apenas ícone */
      border-radius: 14px 0 0 14px; /* Arredonda à esquerda (lado oposto ao que encosta) */

      /* Opacidade Reduzida - Estado Ativo */
      opacity: 0.9;

      /* Z-index alto */
      z-index: 50;

      /* Shadow mais sutil em mobile, igual ao Spotify */
      box-shadow:
        0 4px 16px rgba(0, 123, 154, 0.35),
        0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .badge-content {
      /* Badge quadrada apenas com ícone */
      width: 44px;
      height: 44px;
      padding: 0.5rem;
      justify-content: center;
      align-items: center;
    }

    /* Esconde o texto em mobile */
    .badge-text {
      display: none;
    }

    /* Ícone centralizado em mobile */
    .accessibility-icon {
      font-size: 26px;
    }

    /* Estado Hidden - Após 3s de inatividade */
    .accessibility-badge.is-hidden {
      opacity: 0.5;
      transition: opacity 0.5s ease;
    }

    /* Hover Mobile - Efeito mais sutil, igual ao Spotify */
    .accessibility-badge:hover {
      transform: scale(1.05);
      filter: brightness(1.15);
      box-shadow:
        0 6px 20px rgba(0, 123, 154, 0.5),
        0 3px 8px rgba(0, 0, 0, 0.25);
    }

    .accessibility-badge:hover .accessibility-icon {
      transform: rotate(0) scale(1.05);
    }
  }

  /* ========================================
     MICRO MOBILE (<375px)
     ======================================== */
  @media (max-width: 374px) {
    .badge-content {
      width: 40px;
      height: 40px;
      padding: 0.4rem;
    }

    .accessibility-icon {
      font-size: 24px;
    }
  }

  /* ========================================
     TABLET (768px - 1023px)
     ======================================== */
  @media (min-width: 768px) and (max-width: 1023px) {
    .accessibility-badge {
      bottom: 16%; /* Mesma altura do Spotify em tablet */
      border-radius: 14px 0 0 14px; /* Arredonda à esquerda (lado oposto ao que encosta) */
    }

    .badge-content {
      width: 52px;
      height: 52px;
      padding: 0.625rem;
    }

    .badge-text {
      display: none;
    }

    .accessibility-icon {
      font-size: 28px;
    }
  }

  /* ========================================
     DESKTOP LARGE (≥1440px)
     ======================================== */
  @media (min-width: 1440px) {
    .badge-content {
      padding: 1rem 1.5rem;
      gap: 0.875rem;
    }

    .accessibility-icon {
      font-size: 36px;
    }

    .badge-text {
      font-size: 0.875rem;
      letter-spacing: 0.08em;
    }
  }

  /* ========================================
     REDUCED MOTION - Acessibilidade
     ======================================== */
  @media (prefers-reduced-motion: reduce) {
    .accessibility-badge,
    .accessibility-icon {
      transition:
        opacity 0.3s ease,
        background 0.6s ease,
        filter 0.2s ease;
    }

    .accessibility-badge:hover,
    .accessibility-badge:hover .accessibility-icon {
      transform: none;
      filter: brightness(1.1);
    }

    .accessibility-badge,
    .accessibility-icon {
      animation: none !important;
    }
  }

  /* ========================================
     ANIMATION - Indicador de interatividade
     ======================================== */
  @keyframes icon-bounce {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.08);
    }
  }

  @keyframes badge-pulse {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.02);
    }
  }

  /* Animação sutil apenas em mobile ao carregar, igual ao Spotify */
  @media (max-width: 1023px) {
    .accessibility-badge {
      animation: badge-pulse 1.5s ease-in-out 2;
    }

    .accessibility-icon {
      animation: icon-bounce 1.5s ease-in-out 2;
    }
  }
</style>
